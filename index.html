<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Emails</title>
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.js"></script>
    <script type="text/javascript">
      $(function() {

        // Parse the user agent to determine the device
        var isiPad = navigator.userAgent.match(/iPad/i) != null,
            isiPhone = !isiPad && ((navigator.userAgent.match(/iPhone/i) != null) || (navigator.userAgent.match(/iPod/i) != null)),
            isiOS = isiPad || isiPhone,
            isAndroid = !isiOS && navigator.userAgent.match(/android/i) != null,
            isMobile = isiOS || isAndroid,
            isDesktop = !isMobile;

        // Define all the potential redirection Urls
        var uberDeepLinkUrl = 'uber://',
            uberWebSiteUrl = 'http://www.uber.com',
            uberMobileWebSiteUrl = 'http://m.uber.com',
            appStoreUrl = 'https://itunes.apple.com/us/app/uber/id368677368',
            googlePlayUrl = 'https://play.google.com/store/apps/details?id=com.ubercab';

        handleiOS = function() {
          window.location = uberDeepLinkUrl;

          setTimeout(function() {
            window.location = appStoreUrl;
          }, 25);
        }

        handleAndroid = function() {
          var w = null;
          try {
            window.location = uberDeepLinkUrl;
            // w = window.open(uberDeepLinkUrl, '_blank');
          } catch (e) {
            // no exception
          }
          alert(w);
          if (w) {
            window.location = uberDeepLinkUrl;
          }
          // else { window.location = googlePlayUrl; }
        }

        handleDesktop = function() {
          window.location = uberMobileWebSiteUrl;
        }

        if (isiOS) {
          handleiOS();
        } else if (isAndroid) {
          handleAndroid();
        } else if (isDesktop) {
          handleDesktop();
        }

      });
    </script>
  </head>
  <body>
    <span style='font-weight:bold'>On a mobile device?</span><br>
    We'll open the Uber app<br>
    Or redirect to the ad-hoc app store if not installed.<br><br>
    <span style='font-weight:bold'>On desktop?</span><br>
    In 5 seconds, we'll redirect you to m.uber.com<br><br>

    <span style='font-weight:bold'>&#9996;</span><br>
  </body>
</html>
